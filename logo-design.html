<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logo Design Project Tracker - Grimly's Workflow Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/markdown-it@14.0.0/dist/markdown-it.min.js"></script>
    <style>
        .button-group {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }
        .button-group button {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .button-group button i {
            color: white;
        }
        .generate-estimate {
            background-color: #4a4a4a;
        }
        .generate-estimate:hover {
            background-color: #5a5a5a;
        }
        #previewModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        .modal-content {
            position: relative;
            background-color: white;
            margin: 2rem auto;
            padding: 2rem;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 8px;
            color: #333;
            line-height: 1.6;
        }
        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }
        .close-modal:hover {
            color: #000;
        }
        .preview-content {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        .preview-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        .preview-logo {
            max-width: 180px;
            height: auto;
            margin-bottom: -0.5rem;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .header-text {
            margin-top: 0;
            margin-bottom: 2rem;
        }
        .header-text h1 {
            margin: 0;
            font-size: 1.25rem;
        }
        .header-text .separator {
            border-bottom: 2px solid #ff0000;
            margin: 0.25rem auto;
            width: 50%;
        }
        .header-text p {
            color: #666;
            margin: 0.25rem 0 0 0;
        }
        .preview-content h1 {
            color: #333;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        .preview-content h2 {
            color: #4a4a4a;
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .preview-content h3 {
            color: #666;
            font-size: 1.2rem;
            margin: 2rem 0 1rem;
            border-bottom: 1px solid #888888;
            padding-bottom: 0.75rem;
            text-align: left;
            width: 25%;
        }
        .preview-content h3:first-of-type {
            text-align: center;
            margin-top: 0;
            margin-left: auto;
            margin-right: auto;
        }
        .preview-content h3:nth-of-type(2) {
            margin-top: 3rem;
        }
        .preview-content .timeline h3, 
        .preview-content .fine-print h3 {
            border-bottom: none;
            width: 100%;
            margin-top: 0;
        }
        .preview-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            background-color: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .preview-content th, .preview-content td {
            border: 1px solid #eee;
            padding: 1rem;
            text-align: left;
        }
        .preview-content th {
            background-color: #f8f8f8;
            font-weight: 600;
            color: #4a4a4a;
        }
        .preview-content tr:nth-child(even) {
            background-color: #fafafa;
        }
        .preview-content ul, .preview-content ol {
            padding-left: 1.5rem;
            margin: 1.5rem 0;
        }
        .preview-content li {
            margin-bottom: 0.75rem;
            line-height: 1.6;
            color: #4a4a4a;
        }
        .preview-content li:last-child {
            margin-bottom: 0;
        }
        .preview-content p.centered {
            text-align: center;
            margin: 2.5rem 0;
            color: #4a4a4a;
            font-style: italic;
        }
        .preview-content p {
            margin-bottom: 1.5rem;
            line-height: 1.6;
            color: #4a4a4a;
        }
        .preview-content p:last-child {
            margin-bottom: 0;
        }
        .preview-content .separator {
            border-bottom: 2px solid #ff0000;
            margin: 0.5rem auto;
            width: 50%;
        }
        .preview-content .timeline {
            background-color: #f8f8f8;
            padding: 1.5rem;
            border-radius: 4px;
            margin: 2rem 0;
        }
        .preview-content .timeline h4 {
            color: #4a4a4a;
            margin-bottom: 1rem;
        }
        .preview-content .timeline ul {
            margin: 0;
        }
        .preview-content .timeline li {
            margin-bottom: 0.5rem;
        }
        .preview-content .fine-print {
            background-color: #f8f8f8;
            padding: 1.5rem;
            border-radius: 4px;
            margin: 2rem 0;
            font-size: 0.9rem;
            color: #666;
        }
        .preview-content .fine-print h4 {
            color: #4a4a4a;
            margin-bottom: 1rem;
        }
        .preview-content .fine-print ul {
            margin: 0;
        }
        .preview-content .fine-print li {
            margin-bottom: 0.5rem;
        }
        .preview-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid #eee;
            font-style: italic;
            color: #666;
        }
        @media (max-width: 600px) {
            .preview-content {
                padding: 0 0.5rem;
            }
            .preview-content th, .preview-content td {
                padding: 0.75rem;
            }
            .preview-logo {
                max-width: 150px;
            }
        }
        
        /* Project List Styles */
        .project-list {
            margin-top: 2rem;
            background: #1a1a1a;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }

        .project-list h3 {
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #ffffff;
            font-size: 1.5rem;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }

        .project-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            border: 1px solid #333;
            background: #1a1a1a;
        }

        .project-table th,
        .project-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #333;
            color: #ffffff;
        }

        .project-table th {
            background-color: #2a2a2a;
            font-weight: 600;
            color: #ffffff;
            border-bottom: 2px solid #444;
            font-family: 'Inter', sans-serif;
        }

        .project-table tr:hover {
            background-color: #2a2a2a;
        }

        .status-badge {
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: capitalize;
            letter-spacing: 0.3px;
        }

        .status-inquiry { 
            background-color: #3182ce;
            color: #ebf8ff;
        }
        .status-active { 
            background-color: #38a169;
            color: #f0fff4;
        }
        .status-revision { 
            background-color: #d69e2e;
            color: #fffff0;
        }
        .status-completed { 
            background-color: #4c51bf;
            color: #ebf4ff;
        }
        .status-cancelled { 
            background-color: #e53e3e;
            color: #fff5f5;
        }

        .action-buttons {
            display: flex;
            gap: 0.75rem;
        }

        .action-buttons button {
            padding: 0.35rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 4px;
            cursor: pointer;
            background-color: #333;
            color: white;
            border: none;
            display: flex;
            align-items: center;
            gap: 0.35rem;
            font-weight: 500;
            transition: all 0.2s ease;
            font-family: 'Inter', sans-serif;
        }

        .action-buttons button:hover {
            background-color: #444;
            transform: translateY(-1px);
        }

        .action-buttons i {
            font-size: 0.875rem;
        }

        /* Requirements Section Styles */
        .requirement-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            align-items: center;
        }

        .requirement-item select {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1a1a1a;
            color: white;
        }

        .requirement-item input {
            flex: 2;
            padding: 0.5rem;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1a1a1a;
            color: white;
        }

        .color-preview {
            width: 20px;
            height: 20px;
            border: 1px solid #333;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .remove-requirement {
            background: none;
            border: none;
            color: #ff4444;
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0 0.5rem;
        }

        .remove-requirement:hover {
            color: #ff6666;
        }

        .add-requirement {
            background-color: #333;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .add-requirement:hover {
            background-color: #444;
        }

        .add-requirement i {
            font-size: 0.875rem;
        }

        /* Empty state styling */
        #projectTableBody:empty::after {
            content: "No projects yet. Create a new project using the form below.";
            display: block;
            padding: 2rem;
            text-align: center;
            color: #888;
            font-style: italic;
            background: #2a2a2a;
            font-family: 'Inter', sans-serif;
        }

        /* Amount Due Styles */
        .amount-due-container {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .amount-due-container input {
            flex: 1;
        }

        .reset-amount {
            background: none;
            border: none;
            color: #666;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reset-amount:hover {
            background-color: #333;
            color: white;
        }

        .reset-amount i {
            font-size: 1rem;
        }

        /* Add styles for the discount name field */
        #discount-name-container {
            margin-top: 0.5rem;
        }

        #discount-name {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1a1a1a;
            color: white;
        }

        /* Add styles for write-in prices */
        .write-in-prices {
            margin-top: 0.5rem;
        }

        .price-item {
            margin-top: 0.5rem;
        }

        .price-item label {
            display: block;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
            color: #888;
        }

        .price-item input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #333;
            border-radius: 4px;
            background-color: #1a1a1a;
            color: white;
        }

        /* Update service options styles for a more streamlined look */
        .service-options {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }
        
        .service-option {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: #2a2a2a;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            font-size: 0.9rem;
        }
        
        .service-option:hover {
            background: #333;
        }
        
        .service-option input[type="checkbox"] {
            margin: 0;
            accent-color: #666;
        }

        @media (max-width: 600px) {
            .service-options {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .service-option {
                width: 100%;
            }
        }

        .preview-content .client-requests {
            background-color: #f8f8f8;
            padding: 1.5rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .preview-content .client-requests p {
            margin: 0 0 1rem 0;
            line-height: 1.8;
        }

        .preview-content .client-requests p:last-child {
            margin-bottom: 0;
        }

        /* Load Project Section Styles */
        .load-project-section {
            margin-bottom: 2rem;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }

        .load-project-section h2 {
            margin-bottom: 1.5rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .load-project-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .search-input {
            flex: 1;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .status-filter {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            background: white;
        }

        .load-project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .project-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .project-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .project-card-header h3 {
            margin: 0;
            color: #333;
        }

        .project-card-details {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .project-card-details p {
            margin: 0;
            color: #666;
        }

        .project-card-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: auto;
        }

        .load-button, .estimate-button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .load-button {
            background-color: #4CAF50;
            color: white;
        }

        .load-button:hover {
            background-color: #45a049;
        }

        .estimate-button {
            background-color: #2196F3;
            color: white;
        }

        .estimate-button:hover {
            background-color: #0b7dda;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #666;
            background: #f9f9f9;
            border-radius: 8px;
            grid-column: 1 / -1;
        }

        /* Add styles for the Load Project button and modal */
        .project-list-header {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 1rem;
        }

        .load-project-button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .load-project-button:hover {
            background-color: #45a049;
        }

        .load-project-button i {
            font-size: 1rem;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
        }

        .modal-content {
            position: relative;
            background-color: #1a1a1a;
            margin: 2rem auto;
            padding: 2rem;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            border-radius: 8px;
            color: white;
        }

        .modal-content h2 {
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .modal-project-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            padding: 1rem;
        }

        .project-card {
            background: #ffffff;
            border-radius: 12px;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            border: 1px solid rgba(0,0,0,0.1);
        }

        .project-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .project-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .project-card-header h3 {
            margin: 0;
            color: #2d3748;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .project-card-details {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .project-card-details p {
            margin: 0;
            color: #4a5568;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .project-card-details strong {
            color: #2d3748;
            min-width: 80px;
        }

        .project-card-actions {
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid rgba(0,0,0,0.1);
        }

        .load-button {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            background-color: #38a169;
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .load-button:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
        }

        .load-button i {
            font-size: 1rem;
        }

        .project-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        #modalProjectSearch {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.95rem;
        }

        #modalProjectSearch::placeholder {
            color: rgba(255,255,255,0.5);
        }

        #modalStatusFilter {
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: white;
            font-size: 0.95rem;
            min-width: 150px;
        }

        .load-project-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background-color: #38a169;
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .load-project-button:hover {
            background-color: #2f855a;
            transform: translateY(-2px);
        }

        .load-project-button i {
            font-size: 1rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: rgba(255,255,255,0.6);
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            font-style: italic;
            grid-column: 1 / -1;
        }

        @media (max-width: 768px) {
            .project-list {
                padding: 1.5rem;
            }

            .modal-project-list {
                grid-template-columns: 1fr;
            }

            .project-list-header {
                flex-direction: column;
            }

            .search-filter {
                flex-direction: column;
            }
        }

        .backup-button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            background-color: #4a5568;
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .backup-button:hover {
            background-color: #2d3748;
            transform: translateY(-2px);
        }

        .backup-button i {
            font-size: 1rem;
        }

        #fileInput {
            display: none;
        }

        /* Add styles for the remove button */
        .project-table .remove-button {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background-color: #e53e3e;
            color: white;
        }

        .project-table .remove-button:hover {
            background-color: #c53030;
        }

        /* Update action buttons container for 3 buttons */
        .project-table .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Make buttons more compact on smaller screens */
        @media (max-width: 768px) {
            .project-table .action-buttons button {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
        }

        ul {
            list-style: none;
            padding-left: 1.5rem;
            margin: 0.75rem 0;
        }
        
        ul li {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }
        
        ul li:before {
            content: "✦";
            position: absolute;
            left: 0;
            color: #666;
        }
        
        ul li strong {
            color: #333;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html"><img src="grimlylogo_v1_transparent.png" alt="Grimly Design Studio Logo" class="site-logo"></a>
        </div>
    </header>

    <div class="greeting-section">
        <div class="greeting-content">
            <h1>Logo Design Projects <span class="wave">🎨</span></h1>
            <div class="quick-actions">
                <span>Quick Actions:</span>
                <a href="blog-planner.html" class="quick-action-item">
                    <i class="fa-regular fa-pen-to-square"></i>
                    <span>Blog</span>
                </a>
                <a href="logo-design.html" class="quick-action-item">
                    <i class="fa-solid fa-palette"></i>
                    <span>Logo</span>
                </a>
                <a href="journal.html" class="quick-action-item">
                    <i class="fa-solid fa-note-sticky"></i>
                    <span>Journal</span>
                </a>
                <a href="shopping-list.html" class="quick-action-item">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span>Shopping</span>
                </a>
            </div>
        </div>
    </div>

    <main>
        <!-- Add Project List Section -->
        <section class="project-list">
            <h3><i class="fa-solid fa-list-check"></i> Project List</h3>
            <div class="project-list-header">
                <div class="search-filter">
                    <input type="text" id="modalProjectSearch" placeholder="Search projects..." class="search-input">
                    <select id="modalStatusFilter" class="status-filter">
                        <option value="all">All Status</option>
                        <option value="inquiry">Inquiry</option>
                        <option value="active">Active</option>
                        <option value="revision">In Revision</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
                <button class="load-project-button" onclick="showLoadProjectModal()">
                    <i class="fa-solid fa-folder-open"></i> Load Project
                </button>
                <button class="backup-button" onclick="exportData()">
                    <i class="fa-solid fa-download"></i> Export Data
                </button>
                <button class="backup-button" onclick="importData()">
                    <i class="fa-solid fa-upload"></i> Import Data
                </button>
            </div>
            <table class="project-table">
                <thead>
                    <tr>
                        <th>Client Name</th>
                        <th>Brand Name</th>
                        <th>Package</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="projectTableBody">
                    <!-- Projects will be loaded here -->
                </tbody>
            </table>
        </section>

        <section class="form-section">
            <form id="logoDesignForm">
                <fieldset>
                    <legend><i class="fa-solid fa-user"></i> Client Information</legend>
                    <div class="form-group">
                        <label for="client-name">Client Name:</label>
                        <input type="text" id="client-name" name="client-name" required>
                    </div>
                    <div class="form-group">
                        <label for="sl-username">Second Life Username:</label>
                        <input type="text" id="sl-username" name="sl-username">
                    </div>
                    <div class="form-group">
                        <label for="contact-method">Contact Method:</label>
                        <select id="contact-method" name="contact-method" required>
                            <option value="">Select contact method</option>
                            <option value="email">Email</option>
                            <option value="discord">Discord</option>
                            <option value="bluesky">Bluesky</option>
                            <option value="secondlife">Second Life</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="contact-info">Contact Information:</label>
                        <input type="text" id="contact-info" name="contact-info" required>
                    </div>
                </fieldset>

                <fieldset>
                    <legend><i class="fa-solid fa-building"></i> Project Details</legend>
                    <div class="form-group">
                        <label for="project-status">Project Status:</label>
                        <select id="project-status" name="project-status" required>
                            <option value="inquiry">Inquiry</option>
                            <option value="active">Active</option>
                            <option value="revision">In Revision</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="package-type">Package Type:</label>
                        <select id="package-type" name="package-type" required onchange="handlePackageTypeChange()">
                            <option value="">Select package</option>
                            <option value="logo">Logo Only ($35)</option>
                            <option value="social">Social Media Package ($50)</option>
                            <option value="custom">Custom Package</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="brand-name">Brand Name:</label>
                        <input type="text" id="brand-name" name="brand-name" required>
                    </div>
                    <div class="form-group">
                        <label for="brand-description">Brand Description:</label>
                        <textarea id="brand-description" name="brand-description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label>Client Requests:</label>
                        <div id="requirements-container">
                            <div class="requirement-item">
                                <select class="requirement-type" required onchange="handleRequirementTypeChange(this)">
                                    <option value="">Select request type</option>
                                    <option value="font">Font</option>
                                    <option value="color">Color</option>
                                    <option value="asset">Asset</option>
                                    <option value="other">Other</option>
                                </select>
                                <input type="text" class="requirement-details" placeholder="Enter details..." required>
                                <div class="color-preview" style="display: none;"></div>
                                <button type="button" class="remove-requirement" onclick="removeRequirement(this)">×</button>
                            </div>
                        </div>
                        <button type="button" class="add-requirement" onclick="addRequirement()">
                            <i class="fa-solid fa-plus"></i> Add Another Request
                        </button>
                    </div>
                    <div class="form-group">
                        <label for="reference-images">Reference Images:</label>
                        <input type="file" id="reference-images" name="reference-images" accept="image/*" multiple>
                    </div>
                </fieldset>

                <fieldset>
                    <legend><i class="fa-solid fa-money-bill"></i> Financial Details</legend>
                    <div class="form-group">
                        <label for="payment-method">Payment Method:</label>
                        <select id="payment-method" name="payment-method" required>
                            <option value="">Select payment method</option>
                            <option value="paypal">PayPal</option>
                            <option value="cashapp">CashApp</option>
                            <option value="venmo">Venmo</option>
                            <option value="secondlife">Second Life Linden</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-status">Payment Status:</label>
                        <select id="payment-status" name="payment-status" required>
                            <option value="pending">Pending</option>
                            <option value="partial">Partial Payment</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="amount-due">Amount Due:</label>
                        <div class="amount-due-container">
                            <input type="number" id="amount-due" name="amount-due" step="0.01" onchange="handleAmountDueChange()">
                            <button type="button" class="reset-amount" onclick="resetAmountDue()" title="Reset to calculated amount">
                                <i class="fa-solid fa-rotate-left"></i>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="discount">Discount:</label>
                        <select id="discount" name="discount" onchange="updateAmountDue(); toggleDiscountName()">
                            <option value="0">No Discount</option>
                            <option value="logo_family">Friends & Family (Logo Only)</option>
                            <option value="social_family">Friends & Family (Social Media)</option>
                            <option value="write_in">Special Discount (Write-In)</option>
                        </select>
                        <div id="discount-name-container" style="display: none; margin-top: 0.5rem;">
                            <input type="text" id="discount-name" name="discount-name" placeholder="Enter discount name (e.g., Early Bird Special)" class="form-control">
                        </div>
                        <div id="custom-package-container" style="display: none; margin-top: 1rem;">
                            <label>Select Services:</label>
                            <div class="service-options">
                                <label class="service-option">
                                    <input type="checkbox" name="services" value="logo" checked> Logo Design
                                </label>
                                <label class="service-option">
                                    <input type="checkbox" name="services" value="social"> Social Media Package
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="notes">Project Notes:</label>
                        <textarea id="notes" name="notes" placeholder="Any additional notes about the project..."></textarea>
                    </div>
                </fieldset>

                <div class="button-group">
                    <button type="button" onclick="saveFormData()">Save Project</button>
                    <button type="button" class="generate-estimate" onclick="generateEstimate()">
                        <i class="fa-solid fa-file-pdf"></i>
                        Generate Estimate
                    </button>
                    <button type="button" onclick="previewEstimate()">
                        <i class="fa-solid fa-eye"></i>
                        Preview Estimate
                    </button>
                </div>
            </form>
        </section>
    </main>

    <!-- Preview Modal -->
    <div id="previewModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closePreview()">&times;</span>
            <div id="previewContent" class="preview-content"></div>
        </div>
    </div>

    <!-- Load Project Modal -->
    <div id="loadProjectModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeLoadProjectModal()">&times;</span>
            <h2><i class="fa-solid fa-folder-open"></i> Load Project</h2>
            <div class="modal-search-filter">
                <input type="text" id="modalProjectSearch" placeholder="Search projects..." class="search-input">
                <select id="modalStatusFilter" class="status-filter">
                    <option value="all">All Status</option>
                    <option value="draft">Draft</option>
                    <option value="in-progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
            <div id="modalProjectList" class="modal-project-list">
                <!-- Projects will be loaded here -->
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2024 Grimly's Workflow Hub. All rights reserved.</p>
    </footer>
    <script src="js/database.js"></script>
    <script>
        let currentProjectId = null;

        // Initialize and load projects when page loads
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize database and load projects
                await projectDB.initDatabase();
                console.log('Database initialized');
                
                // Load initial projects
                await loadProjects();
                console.log('Projects loaded');
                
                // Initialize amount due
                updateAmountDue();
            } catch (error) {
                console.error('Failed to initialize:', error);
            }
        });

        async function loadProjects() {
            try {
                console.log('Loading projects...');
                const projects = await projectDB.getAllProjects('logoDesignProjects');
                console.log('Projects retrieved:', projects);
                
                // Update both the main table and the modal list
                await updateProjectTable(projects);
                await updateModalList(projects);
                
                console.log('Projects loaded successfully');
            } catch (error) {
                console.error('Error loading projects:', error);
                alert('Failed to load projects. Please try again.');
            }
        }

        async function updateProjectTable(projects) {
            const tableBody = document.getElementById('projectTableBody');
            if (!tableBody) {
                console.error('Project table body not found');
                return;
            }
            
            // Clear existing content
            tableBody.innerHTML = '';

            if (!projects || projects.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="empty-state">No projects found. Create a new project to get started.</td></tr>';
                return;
            }

            // Sort projects by timestamp (newest first)
            projects.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

            projects.forEach(project => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${project['client-name'] || 'N/A'}</td>
                    <td>${project['brand-name'] || 'N/A'}</td>
                    <td>${formatFieldValue(project['package-type']) || 'N/A'}</td>
                    <td><span class="status-badge status-${project['project-status']}">${project['project-status']}</span></td>
                    <td class="action-buttons">
                        <button onclick="loadProjectForEdit(${project.id})" class="edit-button">
                            <i class="fa-solid fa-edit"></i> Edit
                        </button>
                        <button onclick="generateEstimateForProject(${project.id})" class="estimate-button">
                            <i class="fa-solid fa-file-pdf"></i> Estimate
                        </button>
                        <button onclick="removeProject(${project.id})" class="remove-button">
                            <i class="fa-solid fa-trash"></i> Remove
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }

        async function updateModalList(projects) {
            const modalProjectList = document.getElementById('modalProjectList');
            if (!modalProjectList) {
                console.error('Modal project list not found');
                return;
            }

            modalProjectList.innerHTML = '';

            if (!projects || projects.length === 0) {
                modalProjectList.innerHTML = '<div class="empty-state">No projects found. Create a new project to get started.</div>';
                return;
            }

            projects.forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'project-card';
                projectCard.innerHTML = `
                    <div class="project-card-header">
                        <h3>${project['client-name'] || 'N/A'}</h3>
                        <span class="status-badge status-${project['project-status']}">${project['project-status']}</span>
                    </div>
                    <div class="project-card-details">
                        <p><strong>Brand:</strong> ${project['brand-name'] || 'N/A'}</p>
                        <p><strong>Package:</strong> ${formatFieldValue(project['package-type']) || 'N/A'}</p>
                        <p><strong>Last Updated:</strong> ${new Date(project.timestamp).toLocaleDateString()}</p>
                    </div>
                    <div class="project-card-actions">
                        <button onclick="loadProjectFromModal(${project.id})" class="load-button">
                            <i class="fa-solid fa-folder-open"></i> Load Project
                        </button>
                    </div>
                `;
                modalProjectList.appendChild(projectCard);
            });
        }

        // Update saveFormData to use the consistent database
        async function saveFormData() {
            const form = document.getElementById('logoDesignForm');
            const formData = {};
            const inputs = form.querySelectorAll('input[type="text"], input[type="number"], textarea, input[type="file"], select');
            
            // Get requirements data
            const requirements = [];
            document.querySelectorAll('.requirement-item').forEach(item => {
                const type = item.querySelector('.requirement-type').value;
                const details = item.querySelector('.requirement-details').value;
                if (type && details) {
                    requirements.push({ type, details });
                }
            });
            formData['client-requirements'] = JSON.stringify(requirements);
            
            inputs.forEach(input => {
                if (input.type === 'file') {
                    const files = input.files;
                    if (files.length > 0) {
                        formData[input.name] = Array.from(files).map(file => file.name);
                    }
                } else {
                    formData[input.name] = input.value;
                }
            });

            try {
                if (currentProjectId) {
                    await projectDB.updateProject('logoDesignProjects', currentProjectId, formData);
                } else {
                    await projectDB.saveProject('logoDesignProjects', formData);
                }
                alert("Project saved successfully!");
                await loadProjects(); // Reload both lists
                form.reset();
                currentProjectId = null;
            } catch (error) {
                console.error('Error saving project:', error);
                alert("Failed to save project. Please try again.");
            }
        }

        async function loadProjectForEdit(projectId) {
            if (!projectDB) {
                alert('Database not initialized. Please refresh the page and try again.');
                return;
            }

            try {
                const project = await projectDB.getProject('logoDesignProjects', projectId);
                if (project) {
                    currentProjectId = projectId;
                    const form = document.getElementById('logoDesignForm');
                    
                    // Reset form first
                    form.reset();
                    
                    // Map all form fields
                    const fields = [
                        'client-name',
                        'sl-username',
                        'contact-method',
                        'contact-info',
                        'project-status',
                        'package-type',
                        'brand-name',
                        'brand-description',
                        'payment-method',
                        'payment-status',
                        'amount-due',
                        'discount',
                        'notes'
                    ];

                    // Fill in all form fields
                    fields.forEach(fieldName => {
                        const input = form.querySelector(`#${fieldName}`);
                        if (input && project[fieldName]) {
                            input.value = project[fieldName];
                        }
                    });

                    // Handle discount name if it exists
                    if (project['discount'] === 'write_in' && project['discount-name']) {
                        const discountNameContainer = document.getElementById('discount-name-container');
                        const discountNameInput = document.getElementById('discount-name');
                        discountNameContainer.style.display = 'block';
                        discountNameInput.value = project['discount-name'];
                    }

                    // Handle custom package services if they exist
                    if (project['package-type'] === 'custom' && project.services) {
                        const customPackageContainer = document.getElementById('custom-package-container');
                        customPackageContainer.style.display = 'block';
                        const services = JSON.parse(project.services);
                        document.querySelectorAll('input[name="services"]').forEach(checkbox => {
                            checkbox.checked = services.includes(checkbox.value);
                        });
                    }

                    // Load requirements
                    const requirementsContainer = document.getElementById('requirements-container');
                    requirementsContainer.innerHTML = '';
                    
                    try {
                        const requirements = JSON.parse(project['client-requirements'] || '[]');
                        if (Array.isArray(requirements) && requirements.length > 0) {
                            requirements.forEach((req, index) => {
                                if (index === 0) {
                                    // Update the first requirement item
                                    const firstItem = requirementsContainer.querySelector('.requirement-item') || addRequirement();
                                    const typeSelect = firstItem.querySelector('.requirement-type');
                                    const detailsInput = firstItem.querySelector('.requirement-details');
                                    typeSelect.value = req.type;
                                    detailsInput.value = req.details;
                                    handleRequirementTypeChange(typeSelect);
                                    if (req.type === 'color') {
                                        const colorPreview = firstItem.querySelector('.color-preview');
                                        colorPreview.style.display = 'block';
                                        colorPreview.style.backgroundColor = req.details;
                                    }
                                } else {
                                    // Add additional requirement items
                                    const newItem = document.createElement('div');
                                    newItem.className = 'requirement-item';
                                    newItem.innerHTML = `
                                        <select class="requirement-type" required onchange="handleRequirementTypeChange(this)">
                                            <option value="">Select request type</option>
                                            <option value="font">Font</option>
                                            <option value="color">Color</option>
                                            <option value="asset">Asset</option>
                                            <option value="other">Other</option>
                                        </select>
                                        <input type="text" class="requirement-details" placeholder="Enter details..." required>
                                        <div class="color-preview" style="display: none;"></div>
                                        <button type="button" class="remove-requirement" onclick="removeRequirement(this)">×</button>
                                    `;
                                    const typeSelect = newItem.querySelector('.requirement-type');
                                    const detailsInput = newItem.querySelector('.requirement-details');
                                    typeSelect.value = req.type;
                                    detailsInput.value = req.details;
                                    handleRequirementTypeChange(typeSelect);
                                    if (req.type === 'color') {
                                        const colorPreview = newItem.querySelector('.color-preview');
                                        colorPreview.style.display = 'block';
                                        colorPreview.style.backgroundColor = req.details;
                                    }
                                    requirementsContainer.appendChild(newItem);
                                }
                            });
                        } else {
                            // Ensure there's at least one empty requirement item
                            const firstItem = requirementsContainer.querySelector('.requirement-item') || addRequirement();
                        }
                    } catch (e) {
                        console.error('Error parsing requirements:', e);
                        // Ensure there's at least one empty requirement item
                        const firstItem = requirementsContainer.querySelector('.requirement-item') || addRequirement();
                    }

                    // Update amount due and trigger necessary UI updates
                    updateAmountDue();
                    toggleDiscountName();
                    handlePackageTypeChange();

                    // Scroll to form
                    document.querySelector('.form-section').scrollIntoView({ behavior: 'smooth' });
                }
            } catch (error) {
                console.error('Error loading project for edit:', error);
                alert('Failed to load project. Please try again.');
            }
        }

        function formatRequirements(requirements) {
            if (!Array.isArray(requirements)) return requirements;
            
            // Group requirements by type
            const grouped = requirements.reduce((acc, req) => {
                if (!acc[req.type]) acc[req.type] = [];
                acc[req.type].push(req.details);
                return acc;
            }, {});

            // Format each type's requirements
            return Object.entries(grouped).map(([type, details]) => {
                const formattedType = type.charAt(0).toUpperCase() + type.slice(1);
                if (type === 'color') {
                    return details.map(color => {
                        return `<ul><li><b>${formattedType}</b>: 
                            <span style="display: inline-block; width: 16px; height: 16px; background-color: ${color}; 
                            border: 2px solid #888888; border-radius: 3px; margin-right: 6px; vertical-align: middle;
                            box-shadow: inset 0 0 0 1px rgba(0,0,0,0.1); print-color-adjust: exact; -webkit-print-color-adjust: exact;"></span>
                            <span style="color: #666;">${color}</span></li></ul>`;
                    }).join('\n');
                } else {
                    return details.map(detail => `<ul><li><b>${formattedType}</b>: ${detail}</li></ul>`).join('\n');
                }
            }).join('\n');
        }

        function getFormData() {
            const form = document.getElementById('logoDesignForm');
            const packageType = form.querySelector('#package-type').value;
            
            // Check if any required fields are filled
            const requiredFields = form.querySelectorAll('[required]');
            const isFormEmpty = Array.from(requiredFields).every(field => !field.value);
            
            // If form is empty, return example data
            if (isFormEmpty) {
                return {
                    clientName: 'Example Client',
                    brandName: 'Example Brand',
                    brandDescription: 'A modern lifestyle brand focusing on minimalist design and sustainable products.',
                    clientRequirements: 'Looking for a clean, modern logo that reflects our brand values. Preferred colors are blue and grey.',
                    packageType: packageType || 'logo',
                    paymentMethod: form.querySelector('#payment-method').value || 'paypal',
                    discount: form.querySelector('#discount').value || '0',
                    amountDue: parseFloat(form.querySelector('#amount-due').value) || 0
                };
            }

            // Get requirements data
            const requirements = [];
            document.querySelectorAll('.requirement-item').forEach(item => {
                const type = item.querySelector('.requirement-type').value;
                const details = item.querySelector('.requirement-details').value;
                if (type && details) {
                    requirements.push({ type, details });
                }
            });

            // Return actual form data
            return {
                clientName: form.querySelector('#client-name').value.trim(),
                brandName: form.querySelector('#brand-name').value.trim(),
                brandDescription: form.querySelector('#brand-description').value.trim(),
                clientRequirements: requirements,
                packageType: packageType,
                paymentMethod: form.querySelector('#payment-method').value,
                discount: form.querySelector('#discount').value,
                amountDue: parseFloat(form.querySelector('#amount-due').value) || 0
            };
        }

        function formatFieldValue(value) {
            if (!value) return 'Not specified';
            
            // Format payment method
            if (value === 'secondlife') return 'Linden (Second Life)';
            if (value === 'paypal') return 'PayPal';
            if (value === 'cashapp') return 'CashApp';
            if (value === 'venmo') return 'Venmo';
            
            // Format package type
            if (value === 'logo') return 'Logo Only';
            if (value === 'social') return 'Social Media Package';
            if (value === 'custom') {
                const selectedServices = Array.from(document.querySelectorAll('input[name="services"]:checked'))
                    .map(checkbox => checkbox.value === 'logo' ? 'Logo Design' : 'Social Media Package')
                    .join(' + ');
                return selectedServices || 'Custom Package';
            }
            
            // Default: convert to sentence case
            return value.charAt(0).toUpperCase() + value.slice(1).toLowerCase();
        }

        function toggleDiscountName() {
            const discountSelect = document.getElementById('discount');
            const discountNameContainer = document.getElementById('discount-name-container');
            const discountNameInput = document.getElementById('discount-name');
            const packageType = document.getElementById('package-type').value;
            const customPackageContainer = document.getElementById('custom-package-container');
            
            if (discountSelect.value === 'write_in') {
                discountNameContainer.style.display = 'block';
                discountNameInput.required = true;
                // Show/hide custom package container based on package type
                customPackageContainer.style.display = packageType === 'custom' ? 'block' : 'none';
                initializeWriteInPrices();
            } else {
                discountNameContainer.style.display = 'none';
                discountNameInput.required = false;
            }
        }

        function initializeWriteInPrices() {
            const paymentMethod = document.getElementById('payment-method').value;
            const packageType = document.getElementById('package-type').value;
            const amountDueInput = document.getElementById('amount-due');
            
            // Set default value based on current payment method and package type
            if (packageType === 'custom') {
                // For custom packages, start with base logo price
                amountDueInput.value = paymentMethod === 'secondlife' ? '8000' : '35';
            } else if (paymentMethod === 'secondlife') {
                amountDueInput.value = packageType === 'social' ? '11650' : '8000';
            } else {
                amountDueInput.value = packageType === 'social' ? '50' : '35';
            }
        }

        function updateWriteInTotal() {
            // No need to update total as it's now directly entered
        }

        function generateEstimateContent(formData) {
            // Calculate branding items based on package type
            let brandingItems = '';
            const isLindenPayment = formData.paymentMethod === 'secondlife';
            
            if (formData.packageType === 'logo') {
                brandingItems = `| Logo Design | ${isLindenPayment ? 'L$8,000' : '$35'} |`;
            } else if (formData.packageType === 'social') {
                brandingItems = `| Social Media Package | ${isLindenPayment ? 'L$11,650' : '$50'} |`;
            } else if (formData.packageType === 'custom') {
                const selectedServices = Array.from(document.querySelectorAll('input[name="services"]:checked'))
                    .map(checkbox => checkbox.value === 'logo' ? 'Logo Design' : 'Social Media Package')
                    .join(' + ');
                const amount = isLindenPayment ? `L$${Number(formData.amountDue).toLocaleString()}` : `$${formData.amountDue}`;
                brandingItems = `| ${selectedServices} | ${amount} |`;
            }

            let whatYouGet = `<ul>
<li>A custom logo that perfectly captures your brand's personality</li>
<li>Multiple initial concepts to choose from</li>
<li>Three rounds of revisions to get everything just right</li>
<li>High-resolution files (JPG, PNG) ready for any use</li>`;

            if (formData.packageType === 'social' || (formData.packageType === 'custom' && Array.from(document.querySelectorAll('input[name="services"]:checked')).some(cb => cb.value === 'social'))) {
                whatYouGet += `
<li>Social media banner design</li>
<li>Social media icon set</li>`;
            }

            whatYouGet += `</ul>`;

            let content = `### ❣️Hey, ${formData.clientName}! 👋

I'm thrilled you're interested in working together on a logo for ${formData.brandName}! I've put together this estimate to give you a clear picture of what to expect.

<p class="centered">I'm really looking forward to bringing your vision to life and creating something special for your brand. ♥</p>

### Project Info
<b>Project Type</b>: ${formatFieldValue(formData.packageType)}

<b>Brand Name</b>: ${formData.brandName}
${formData.brandDescription ? `\n<b>Brand Description</b>: ${formData.brandDescription}` : ''}

${formData.clientRequirements.length > 0 ? `### Client Requests\n<div class="client-requests">\n${formatRequirements(formData.clientRequirements)}\n</div>` : ''}

### What You'll Get
${whatYouGet}

### Timeline
<b>Initial Concepts</b>: 3-5 business days

<b>Revision Rounds</b>: 2-3 business days each

<b>Final Files</b>: 1-2 business days

<b>Total Timeline</b>: Up to two weeks

### Payment Details
| Service | Amount |
|---------|---------|
${brandingItems}
| <i>Payment Method</i> | ${formatFieldValue(formData.paymentMethod)} |

<ul>
<li><b>Payment Schedule</b>: 50% to get started, 50% before final files</li>
<li><b>Usage Rights</b>: Full commercial rights for your business</li>
<li><b>Deliverables</b>: High-resolution JPG and PNG files</li>
</ul>

### The Fine Print ™️
<ul>
<li><b>Revisions</b>: Three rounds included (minor tweaks to your chosen concept)</li>
<li><b>Extra Revisions</b>: ${isLindenPayment ? 'L$3,500' : '$15'}/hour after the included rounds</li>
<li><b>Cancellation</b>: 25% deposit retained if cancelled before concepts, non-refundable after concepts shared</li>
</ul>

---

<div style="text-align: center; color: #666; margin-top: 2rem;">
<p style="margin-bottom: 0.5rem;">*This estimate is valid for 30 days from today.*</p>
<p style="margin-top: 1.5rem; margin-bottom: 0.5rem;">Got questions? I'm here to help!</p>
<p style="margin: 0;">Discord: gravesghostly | Email: gravesghostly@gmail.com | Second Life: graves.ghostly</p>
</div>`;

            return content;
        }

        function previewEstimate() {
            const formData = getFormData();
            const previewContent = generateEstimateContent(formData);

            // Convert markdown to HTML
            const md = window.markdownit({
                html: true
            });
            const htmlContent = md.render(previewContent);

            // Add content to preview
            const previewDiv = document.getElementById('previewContent');
            previewDiv.innerHTML = htmlContent;

            // Show modal
            document.getElementById('previewModal').style.display = 'block';
        }

        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('previewModal');
            if (event.target === modal) {
                closePreview();
            }
        }

        async function generateEstimate() {
            const formData = getFormData();
            let estimateContent = generateEstimateContent(formData);
            
            try {
                // Convert markdown to HTML
                const md = window.markdownit({
                    html: true
                });
                const htmlContent = md.render(estimateContent);

                // Create a complete HTML document with the direct image URL
                const fullHtml = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${formData.brandName} - Logo Design Estimate</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.5;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            background-color: white;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .preview-logo {
            max-width: 150px;
            height: auto;
            margin: 0 auto 0.5rem;
            display: block;
        }

        .header-text h1 {
            margin: 0;
            font-size: 1.25rem;
        }

        .header-text .separator {
            border-bottom: 2px solid #ff0000;
            margin: 0.25rem auto;
            width: 50%;
        }

        .header-text p {
            color: #666;
            margin: 0.25rem 0 0 0;
            font-size: 0.9rem;
        }

        h3 {
            color: #333;
            font-size: 1.1rem;
            margin: 1.5rem 0 0.75rem;
            padding-bottom: 0.25rem;
            border-bottom: 1px solid #ddd;
        }

        ul {
            list-style: none;
            padding-left: 1.25rem;
            margin: 0.5rem 0;
        }

        ul li {
            position: relative;
            padding-left: 1.25rem;
            margin-bottom: 0.35rem;
            line-height: 1.4;
        }

        ul li:before {
            content: "✦";
            position: absolute;
            left: 0;
            color: #666;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 0.75rem 0;
            font-size: 0.95rem;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 0.5rem 0.75rem;
            text-align: left;
        }

        th {
            background-color: #f8f8f8;
        }

        .centered {
            text-align: center;
            margin: 1rem 0;
            color: #666;
            font-style: italic;
            font-size: 0.95rem;
        }

        .client-requests {
            background-color: #f8f8f8;
            padding: 1rem;
            border-radius: 4px;
            margin: 0.75rem 0;
            font-size: 0.95rem;
        }

        .footer {
            text-align: center;
            color: #666;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #ddd;
            font-size: 0.9rem;
        }

        .footer p {
            margin: 0.25rem 0;
        }

        @media print {
            @page {
                margin: 1.5cm;
                size: letter portrait;
            }

            body {
                padding: 0;
                margin: 0;
                background: white;
                font-size: 11pt;
            }

            .preview-logo {
                max-width: 120px;
            }

            h3 {
                break-after: avoid;
                page-break-after: avoid;
            }

            ul {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            table {
                break-inside: avoid;
                page-break-inside: avoid;
            }

            .client-requests {
                break-inside: avoid;
                page-break-inside: avoid;
                background-color: #f8f8f8 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }

            .footer {
                position: fixed;
                bottom: 0;
                width: 100%;
                break-inside: avoid;
                page-break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="preview-header">
        <img src="https://i.gyazo.com/96baf12dd6eca2c2cb906d2151e6272e.png" alt="Grimly Design Studio Logo" class="preview-logo">
        <div class="header-text">
            <h1>Grimly Design Studio</h1>
            <div class="separator"></div>
            <p>Freelance Graphic Design - Indie Game Design | Website: https://grimly.rip</p>
        </div>
    </div>
    ${htmlContent}
</body>
</html>`;

                // Create a blob and download link
                const blob = new Blob([fullHtml], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = formData.brandName === 'Example Brand' ? 
                    'Example_Logo_Design_Estimate.html' : 
                    `${formData.brandName.replace(/[^a-z0-9]/gi, '_')}_Logo_Design_Estimate.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

            } catch (error) {
                console.error('Error generating estimate:', error);
                alert('There was an error generating the estimate. Please try again.');
            }
        }

        async function generateEstimateForProject(projectId) {
            try {
                const project = await projectDB.getProject('logoDesignProjects', projectId);
                if (project) {
                    // Load project data into form temporarily
                    const currentFormData = getFormData(); // Save current form data
                    loadProjectForEdit(projectId);
                    
                    // Generate estimate
                    generateEstimate();
                    
                    // Restore form data
                    const form = document.getElementById('logoDesignForm');
                    Object.entries(currentFormData).forEach(([key, value]) => {
                        const input = form.querySelector(`[name="${key}"]`);
                        if (input) input.value = value;
                    });
                }
            } catch (error) {
                console.error('Error generating estimate for project:', error);
            }
        }

        function addRequirement() {
            const container = document.getElementById('requirements-container');
            const newItem = document.createElement('div');
            newItem.className = 'requirement-item';
            newItem.innerHTML = `
                <select class="requirement-type" required onchange="handleRequirementTypeChange(this)">
                    <option value="">Select request type</option>
                    <option value="font">Font</option>
                    <option value="color">Color</option>
                    <option value="asset">Asset</option>
                    <option value="other">Other</option>
                </select>
                <input type="text" class="requirement-details" placeholder="Enter details..." required>
                <div class="color-preview" style="display: none;"></div>
                <button type="button" class="remove-requirement" onclick="removeRequirement(this)">×</button>
            `;
            container.appendChild(newItem);
        }

        function removeRequirement(button) {
            const item = button.parentElement;
            const container = document.getElementById('requirements-container');
            if (container.children.length > 1) {
                item.remove();
            } else {
                // If it's the last item, just clear the values
                item.querySelector('.requirement-type').value = '';
                item.querySelector('.requirement-details').value = '';
            }
        }

        function handleRequirementTypeChange(select) {
            const item = select.closest('.requirement-item');
            const colorPreview = item.querySelector('.color-preview');
            const input = item.querySelector('.requirement-details');
            
            if (select.value === 'color') {
                colorPreview.style.display = 'block';
                input.addEventListener('input', function() {
                    // Format hex code if needed
                    let colorValue = this.value.trim();
                    if (colorValue.match(/^[0-9a-f]{6}$/i)) {
                        colorValue = '#' + colorValue;
                        this.value = colorValue;
                    } else if (colorValue.match(/^[0-9a-f]{3}$/i)) {
                        colorValue = '#' + colorValue;
                        this.value = colorValue;
                    }
                    updateColorPreview(colorValue, colorPreview);
                });
            } else {
                colorPreview.style.display = 'none';
                input.removeEventListener('input', updateColorPreview);
            }
        }

        function updateColorPreview(colorValue, previewElement) {
            // Try to parse the color value
            let color = colorValue.trim();
            
            // Check if it's a hex color without #
            if (color.match(/^[0-9a-f]{6}$/i) || color.match(/^[0-9a-f]{3}$/i)) {
                color = '#' + color;
            }
            
            // Check if it's a hex color (with or without #)
            if (color.startsWith('#') || color.match(/^#[0-9a-f]{6}$/i) || color.match(/^#[0-9a-f]{3}$/i)) {
                previewElement.style.backgroundColor = color;
                return;
            }
            
            // Check if it's a named color
            const tempDiv = document.createElement('div');
            tempDiv.style.color = color;
            if (tempDiv.style.color !== '') {
                previewElement.style.backgroundColor = color;
                return;
            }
            
            // If not a valid color, show default
            previewElement.style.backgroundColor = '#ffffff';
        }

        function updateAmountDue() {
            const packageType = document.getElementById('package-type').value;
            const discount = document.getElementById('discount').value;
            const paymentMethod = document.getElementById('payment-method').value;
            const amountDueInput = document.getElementById('amount-due');

            // If write-in discount is selected, don't update the amount
            if (discount === 'write_in') {
                amountDueInput.readOnly = false;
                // Only set a default value if the field is empty
                if (!amountDueInput.value || amountDueInput.value === '0') {
                    if (paymentMethod === 'secondlife') {
                        amountDueInput.value = packageType === 'social' ? '11650' : '8000';
                    } else {
                        amountDueInput.value = packageType === 'social' ? '50' : '35';
                    }
                }
                return;
            }

            // For non-write-in cases, make the field readonly and update the amount
            amountDueInput.readOnly = true;
            
            let finalPrice = 0;
            if (paymentMethod === 'secondlife') {
                if (packageType === 'social') {
                    finalPrice = discount === 'social_family' ? 9310 : 11650;
                } else if (packageType === 'logo') {
                    finalPrice = discount === 'logo_family' ? 7000 : 8000;
                }
            } else {
                if (packageType === 'social') {
                    finalPrice = discount === 'social_family' ? 40 : 50;
                } else if (packageType === 'logo') {
                    finalPrice = discount === 'logo_family' ? 30 : 35;
                }
            }
            
            amountDueInput.value = finalPrice;
        }

        function handlePackageTypeChange() {
            const packageType = document.getElementById('package-type').value;
            const customPackageContainer = document.getElementById('custom-package-container');
            const discount = document.getElementById('discount').value;
            
            if (packageType === 'custom') {
                customPackageContainer.style.display = 'block';
                // If write-in discount is selected, initialize the amount
                if (discount === 'write_in') {
                    initializeWriteInPrices();
                }
                // Log selected services
                const selectedServices = Array.from(document.querySelectorAll('input[name="services"]:checked'))
                    .map(checkbox => checkbox.value);
                console.log('Selected services:', selectedServices);
            } else {
                customPackageContainer.style.display = 'none';
                if (discount === 'write_in') {
                    initializeWriteInPrices();
                }
            }
        }

        function handleAmountDueChange() {
            const amountDueInput = document.getElementById('amount-due');
            const discount = document.getElementById('discount').value;
            
            // Only allow manual edits if write-in discount is selected
            if (discount === 'write_in') {
                amountDueInput.dataset.manual = 'true';
            }
        }

        // Add event listener for amount due changes
        document.getElementById('amount-due').addEventListener('input', handleAmountDueChange);

        // Add event listeners for form field changes
        document.getElementById('package-type').addEventListener('change', handlePackageTypeChange);
        document.getElementById('payment-method').addEventListener('change', updateAmountDue);
        document.getElementById('discount').addEventListener('change', updateAmountDue);

        function showLoadProjectModal() {
            const modal = document.getElementById('loadProjectModal');
            if (!modal) {
                console.error('Modal element not found');
                return;
            }
            modal.style.display = 'block';
            loadModalProjects();
        }

        function closeLoadProjectModal() {
            const modal = document.getElementById('loadProjectModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        async function loadModalProjects() {
            try {
                const projects = await projectDB.getAllProjects('logoDesignProjects');
                const modalProjectList = document.getElementById('modalProjectList');
                modalProjectList.innerHTML = '';

                if (!projects || projects.length === 0) {
                    modalProjectList.innerHTML = '<div class="empty-state">No projects found. Create a new project to get started.</div>';
                    return;
                }

                // Sort projects by timestamp (newest first)
                projects.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

                projects.forEach(project => {
                    const projectCard = document.createElement('div');
                    projectCard.className = 'project-card';
                    projectCard.innerHTML = `
                        <div class="project-card-header">
                            <h3>${project['client-name'] || 'N/A'}</h3>
                            <span class="status-badge status-${project['project-status']}">${project['project-status']}</span>
                        </div>
                        <div class="project-card-details">
                            <p><strong>Brand:</strong> ${project['brand-name'] || 'N/A'}</p>
                            <p><strong>Package:</strong> ${project['package-type'] || 'N/A'}</p>
                            <p><strong>Last Updated:</strong> ${new Date(project.timestamp).toLocaleDateString()}</p>
                        </div>
                        <div class="project-card-actions">
                            <button onclick="loadProjectFromModal(${project.id})" class="load-button">
                                <i class="fa-solid fa-folder-open"></i> Load Project
                            </button>
                        </div>
                    `;
                    modalProjectList.appendChild(projectCard);
                });

                // Add event listeners for search and filter
                const searchInput = document.getElementById('modalProjectSearch');
                const statusFilter = document.getElementById('modalStatusFilter');

                if (searchInput && statusFilter) {
                    const filterProjects = () => {
                        const searchTerm = searchInput.value.toLowerCase();
                        const status = statusFilter.value;
                        const projectCards = modalProjectList.querySelectorAll('.project-card');

                        projectCards.forEach(card => {
                            const clientName = card.querySelector('h3').textContent.toLowerCase();
                            const projectStatus = card.querySelector('.status-badge').textContent.toLowerCase();
                            const matchesSearch = clientName.includes(searchTerm);
                            const matchesStatus = status === 'all' || projectStatus === status;

                            card.style.display = matchesSearch && matchesStatus ? 'block' : 'none';
                        });
                    };

                    searchInput.addEventListener('input', filterProjects);
                    statusFilter.addEventListener('change', filterProjects);
                }
            } catch (error) {
                console.error('Error loading projects in modal:', error);
            }
        }

        async function loadProjectFromModal(projectId) {
            try {
                await loadProjectForEdit(projectId);
                closeLoadProjectModal();
            } catch (error) {
                console.error('Error loading project:', error);
                alert('Failed to load project. Please try again.');
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('loadProjectModal');
            if (event.target === modal) {
                closeLoadProjectModal();
            }
        }

        // Update the preview modal styles to be light mode
        const previewModalStyles = `
            #previewModal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0,0,0,0.7);
                z-index: 1000;
            }
            #previewModal .modal-content {
                position: relative;
                background-color: white;
                margin: 2rem auto;
                padding: 2rem;
                width: 90%;
                max-width: 800px;
                max-height: 80vh;
                overflow-y: auto;
                border-radius: 8px;
                color: #333;
            }
            #previewModal .preview-content {
                font-family: 'Inter', sans-serif;
                color: #333;
                line-height: 1.6;
            }
            #previewModal .preview-content h1,
            #previewModal .preview-content h2,
            #previewModal .preview-content h3 {
                color: #333;
            }
            #previewModal .preview-content p {
                color: #4a4a4a;
            }
            #previewModal .preview-content table {
                background-color: white;
                color: #333;
            }
            #previewModal .preview-content th {
                background-color: #f8f8f8;
                color: #4a4a4a;
            }
            #previewModal .preview-content td {
                color: #4a4a4a;
            }
            #previewModal .close-modal {
                color: #666;
            }
            #previewModal .close-modal:hover {
                color: #333;
            }
        `;

        // Add the styles to the document
        const styleSheet = document.createElement("style");
        styleSheet.textContent = previewModalStyles;
        document.head.appendChild(styleSheet);

        async function exportData() {
            try {
                const projects = await projectDB.getAllProjects('logoDesignProjects');
                const data = {
                    version: '1.0',
                    timestamp: new Date().toISOString(),
                    projects: projects
                };

                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `grimly_projects_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Failed to export data. Please try again.');
            }
        }

        function importData() {
            const fileInput = document.getElementById('fileInput');
            fileInput.click();

            fileInput.onchange = async function(e) {
                try {
                    const file = e.target.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            // Validate the backup file
                            if (!data.version || !data.projects || !Array.isArray(data.projects)) {
                                throw new Error('Invalid backup file format');
                            }

                            // Confirm before import
                            if (!confirm('This will replace all existing projects. Are you sure you want to continue?')) {
                                return;
                            }

                            // Import each project
                            for (const project of data.projects) {
                                if (project.id) {
                                    await projectDB.updateProject('logoDesignProjects', project.id, project);
                                } else {
                                    await projectDB.saveProject('logoDesignProjects', project);
                                }
                            }

                            await loadProjects(); // Refresh the display
                            alert('Data imported successfully!');
                        } catch (error) {
                            console.error('Error processing backup file:', error);
                            alert('Failed to import data. Invalid backup file format.');
                        }
                    };
                    reader.readAsText(file);
                } catch (error) {
                    console.error('Error importing data:', error);
                    alert('Failed to import data. Please try again.');
                }
            };

            // Reset the input so the same file can be selected again
            fileInput.value = '';
        }

        async function removeProject(projectId) {
            try {
                // Show confirmation dialog
                const confirmed = confirm('Are you sure you want to remove this project? This action cannot be undone.');
                
                if (confirmed) {
                    await projectDB.deleteProject('logoDesignProjects', projectId);
                    await loadProjects(); // Refresh both lists
                    alert('Project removed successfully.');
                }
            } catch (error) {
                console.error('Error removing project:', error);
                alert('Failed to remove project. Please try again.');
            }
        }
    </script>
</body>
</html> 